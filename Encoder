#!usr/bin/python
#Purpose: SubEncode Shellcode

from sys import argv, stdout


allowed_chars = ("\x01\x02\x03\x04\x05\x06\x07\x08\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x30\x31\x32\x33\x34\x35\x36\x37\x38"
"\x39\x41\x42\x43\x44\x45\x46\x47\x3b\x3c\x3d\x3e\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c"
"\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d"
"\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e"
"\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e")

allowed_chars = list(allowed_chars)

if len(argv) < 2:
    print "You Are Missing The Input Hex Value" % argv[0]
    print "Example to Run the Script is: python subencoder.py  9F8F9D0F" % argv[0]
    exit()

shellcode = argv[1]
found = False
overflow = False

reversed_shellcode =  "\\x"+shellcode[6:8]+"\\x"+shellcode[4:6]+"\\x"+shellcode[2:4]+"\\x"+shellcode[0:2]

reversed_shellcode =  reversed_shellcode.replace('\\x','')

zero =  'FFFFFFFF'
sum = int(zero, 16)  - int(reversed_shellcode, 16) + 1

dword =  hex(sum)

dword = dword[2:]
byte1 = dword[0:2]
byte2 = dword[2:4]
byte3 = dword[4:6]
byte4 = dword[6:8]
print "Sum needs to Equal: " +dword + "\n"
print "The First Number is: " +byte1
print "The Second Number is: " +byte2
print "The Third Number is:  " +byte3
print "The Fourth Number is: " +byte4

for i in allowed_chars:
        counter1 = 0
        value1  = i[counter1]
        value1 =  '{0:2x}'.format(int(ord(value1)))
        #print value1
        counter1 =  counter1 + 1
        for b in allowed_chars:
            counter2 = 0
            value2 = b[counter2]
            value2 = '{0:2x}'.format(int(ord(value2)))
            #print value1 + " " + value2
            counter2 + counter2 + 1
            for c in allowed_chars:
                counter3 = 0
                value3 = c[counter3]
                #print "ascii: " + value3 + " " + "hex: " + '{0:x}'.format(int(ord(value3)))
                value3 = '{0:2x}'.format(int(ord(value3)))
                sub =  int(value1, 16) + int(value2, 16) + int(value3, 16)
                answer = hex(sub)
                if answer[2:] == byte4:
                    print value1 + " + " + value2 + " + " + value3 + " = " +  answer[2:]
                elif answer[2:] == byte3:

            counter3 = counter3 + 1
